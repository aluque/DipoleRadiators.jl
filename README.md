# DipoleRadiators.jl

This is a julia package to compute electric fields generated by transmission line models.  It works
by decomposing the transmission line into a set of small dipole radiators. The main purpose is to 
compute electric fields radiated by lightning discharges with different electric current profiles.

## Install
Install this package from the julia prompt with 

```julia
julia> using Pkg
julia> Pkg.add("https://github.com/aluque/DipoleRadiators.jl")
```

This packages has been tested with julia versions 1.5, 1.6 and 1.7. Higher versions should work too.

## Use
### Load
After installation you can load the package in julia with
```julia
using DipoleRadiators
```

### Defining transmission lines
Currently the package supports the creation of generalized MTLEs 
(Modified Transmission Line with Exponential decay). To create an MTLE use
```julia
tl = mtle(pulse, r0, r1, v, λ, n; mirror=false, w0=1.0, t0=0.0)
```
where `pulse` defined the current pulse travelling through the transmission, line (see below),
`r0` and `r1` are the start and endpoints of the line (as 3d vectors, in meters), 
`v` is the pulse velocity in m/s, `λ` is the spatial atenuation (in 1/m) and `n` is the number
of dipoles that will compose the TL. If `mirror` is `true`, adds an image TL
considering that z=0 is the surface of a perfect conductor (used to model Earth's surface).
To join several MTLEs easily we allow an extra constant attenuation `w0` and an extra delay `t0`.

Because a TL is just a `Vector` of dipole elements, you can join several TLs toghether simply by
```julia
tl = vcat(tl1, tl2)
```
### Defining current pulses
An arbitrary current pulse with the `CurrentPulse` method, that receives electric current as a function of time as its first argument.  This defines the current at the injection point (i.e. `r0` above).

```julia
# Times in s
t1 = 1e-5
t2 = 2e-5

# Min time considered
tmin = 0.0

# Max time considered
tmax = 5e-4

# Time interval for the discretization
dt = 5e-6

pulse = CurrentPulse(t -> exp(-t/t2) - exp(-t/t1), tmin, tmax, dt)
```

### Computing electric fields
Once the transmission line and current pulse are defined you can compute the radiated electric
fields at any location with 
```julia
f = fields(tl, robs, t)
```
where `tl` is a transmission line, `robs` is the point of observation and `t` is a vector with the
desired times of observation.

The `fields` method returns a vector of `FieldsComponents` that contains information about the components of the electric fields and its contributions (static, induction, radiation).  You can use the methods `static`, `induction`, `radiation` and `total` on an element or the full vector. If you pass a second argument, only the corresponding component will be returned.  For example
```julia
ez = total(f, 3)
```
returns the total electric field along the 3rd coordinate (z).

## Contact
For any questions regarding this code, contact the author, Alejandro Luque, at IAA-CSIC.
